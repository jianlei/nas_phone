<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<html lang="en" class="no-js">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Home</title>
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />

	<script src="js/modernizr.custom.js"></script>
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/jquery.fancybox.css" rel="stylesheet">
	<link href="css/flickity.css" rel="stylesheet">
	<link href="css/animate.css" rel="stylesheet">

	<link href="css/styles.css" rel="stylesheet">
	<link href="css/queries.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="js/html5shiv.js"></script>
		<script src="js/respond.min.js"></script>
		<![endif]-->
	<style>
		.disc-section{
			margin: 0 0%;
		}
	</style>
</head>

<body>
	<header id="main">
		<section class="hero">
			<div class="container">
				<div class="row nav-wrapper">
					<div class="col-md-6 col-sm-6 col-xs-6 text-left" style="font-size: 20px">
					</div>

				</div>
				<div class="row hero-content">
					<div class="col-md-12 text-center">
						<h1 class="animated fadeInDown">手机"链"盟
							<br/>基于星云链</h1>
						<!--<a href="#features" class="read-btn animated fadeInUp">查询</a>-->
						<br/>让每一部手机都能够找到家</h1>
						<h1 id="noExtension" style="display: none">请安装
							<a target="_blank" href="https://github.com/ChengOrangeJu/WebExtensionWallet">WebExtensionWallet</a> 再使用</h1>
					</div>
				</div>
			</div>
		</section>
	</header>
	<section class="services-list page-section" id="features">
		<div class="container">
			<div class="row">
				<div class="title-section text-center">
					<h2>功能介绍</h2>
					<div class="divider">
						<i class="fa fa-star-o fa-lg"></i>
					</div>
				</div>
				<div class="disc-section text-center">
					<p>基于新一代区块链公链星云链，致力于构建公开透明可追踪的Mobile信息查询! <br />为每一台移动设备在公有链上建立唯一的对应，让"手机"不再孤单，并且可被追踪！</p>
				</div>
				<!--<div class="col-md-12">

					<div class="col-md-4 feature-1 wp2">
						<div class="feature-icon">
							<img src="img/3gn.png" >
						</div>
						<div class="feature-content">
							<h1>公开透明</h1>
							<p>任何人可通过该网站查询商品供应链信息，保证每个环节公开透明</p>
						</div>
					</div>
					<div class="col-md-4 feature-2 wp2 delay-05s">
						<div class="feature-icon">
							<img src="img/1gn.png" >
						</div>
						<div class="feature-content">
							<h1>可溯源</h1>
							<p>从源头（供应商）到终端消费者，保障商品质量，防伪</p>
						</div>
					</div>
					<div class="col-md-4 feature-3 wp2 delay-1s">
						<div class="feature-icon">
							<img src="img/2gn.png" >
						</div>
						<div class="feature-content">
							<h1>不可篡改</h1>
							<p>基于新一代区块链公链星云链，一旦记录，永久不可篡改</p>
						</div>
					</div>

				</div>-->
			</div>
		</div>
	</section>
	<section id="about" class="wjl page-section"  >
		<div class="aboutUs-wrap">
			<div class="title-section text-center wp2">
				<h2 style="color: white">手机信息查询</h2>
				<br>
			</div>
			<div class="container">
				<div class="row">
					<input type="text" name="name" id="search_value" required="required" class="form wp2" placeholder="请填写手机唯一识别码编号(例如:ae703cf9555a3ab7fcf78cd03713a716be6a59ca)">
					<div class="relative fullwidth col-xs-12">
						<!-- Send Button -->
						<button id="search" name="submit" class="form-btn semibold wp2">查询</button>
					</div>
				</div>
				<div class="row" id="app">
					<table id="tableList" class="table table-bordered" style="display:none;color: #fff;margin-top: 30px">
						<thead>
							<tr>
								<th>唯一识别码</th>
								<th>手机品牌</th>
								<th>手机厂商</th>
								<th>手机价格</th>
							</tr>
						</thead>
						<tbody>
							<tr v-for="mobileItem in list">
								<td v-html="mobileItem.phoneId"></td>
								<td v-html="mobileItem.pinpai"></td>
								<td v-html="mobileItem.model"></td>
								<td v-html="mobileItem.price"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</section>
<!--	<section class="testimonial page-section">
			<div class="container">
				<div class="row">  
					<div class="col-md-12">
						<div class="features-slider">
								<ul class="slides" id="featuresSlider">
									<li>
										<h2>服务商认证查询</h2>
										<p>查询服务商信息</p>
										<p>开发中，尽请期待</p>
									</li>
									<li>
										<h2>商品防伪</h2>
										<p>指定服务商</p>
										<p>开发中，尽请期待</p>
									</li>
								</ul>
						</div>
					</div>
				</div>
			</div>
		</section>-->
	<section id="contact" class="container page-section">
		<!-- Contact Inner -->
		<div class="inner contact wp2 delay-05s">
			<div class="title-section text-center">
				<h2>手机信息录入</h2>
				<div class="divider">
					<i class="fa fa-star-o fa-lg"></i>
				</div>
			</div>
			<!-- Form Area -->
			<div class="contact-form">
				<!-- Form -->
				<!-- Left Inputs -->
				<div class="col-xs-6 animated fadeInLeft visible" data-animation="fadeInLeft" data-animation-delay="300">
					<input type="text" id="phoneId" class="form" placeholder="手机唯一识别码">
					<input type="text" id="model" class="form" placeholder="型号">
				</div>
				<!-- End Left Inputs -->
				<!-- Right Inputs -->
				<div class="col-xs-6 animated fadeInRight visible" data-animation="fadeInRight" data-animation-delay="400">

					<input type="text" id="pinpai" class="form" placeholder="厂商">

					<input type="text" id="price" class="form" placeholder="价格">
				</div>
				<!-- End Right Inputs -->
				<!-- Bottom Submit -->
				<div class="relative fullwidth col-xs-12">
					<!-- Send Button -->
					<button id="push" name="submit" class="form-btn semibold">提交</button>
				</div>
				<!-- End Bottom Submit -->
				<!-- Clear -->
				<div class="clear"></div>
			</div>
			<!-- End Contact Form Area -->
		</div>
		<!-- End Inner -->
	</section>

	<footer id="footer" class="footer">
		<section id="site-socials" class="no-padding white-bg">
			<div class="site-socials inner no-padding">

				<!-- Adress, Mail -->
				<div class="address socials animated fadeInRight visible" data-animation="fadeInRight" data-animation-delay="500">
					<!-- Phone Number, Mail -->
					<p>Copyright &copy; 2018.基于
						<a href="https://nebulas.io/" target="_blank">NAS</a>的手机联盟查询系统
						<a href="https://incentive.nebulas.io/cn/signup.html?invite=Qm5eB" target="_blank">点我发布DAPP获取100NAS</a>
					</p>
					<p>联系方式：894151369@qq.com</p>

				</div>
				<!-- End Adress, Mail -->
			</div>
			<!-- End Inner -->
		</section>
	</footer>
	<script src=js/nebPay.js></script>
	<script src="js/toucheffects.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/flickity.pkgd.min.js"></script>
	<script src="js/jquery.fancybox.pack.js"></script>
	<script src="js/waypoints.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/scripts.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<script src="js/layer/layer.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="lib/nebulas.js"></script>

	<script>
		$(function () {
			// var NebPay = require("nebpay");
			// var nebPay = new NebPay();
            var dappContactAddress = "n1xPRuGvMRtf7fCQGEsakGwwJkCFuEgYqa3";
            var nebulas = require("nebulas"), Account = Account, neb = new nebulas.Neb();
            // neb.setRequest(new nebulas.HttpRequest("https://testnet.nebulas.io"))
            neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"))
            var NebPay = require("nebpay");     //https://github.com/nebulasio/nebPay
            var nebPay = new NebPay();

			// var dappAddress = "n1pwxwJwcUh9B9tNB26es2CVmrxt7SoTtGM";
			// var dappAddress = "n1xPRuGvMRtf7fCQGEsakGwwJkCFuEgYqa3";//主网
			// var dappContactAddress = "n1xPRuGvMRtf7fCQGEsakGwwJkCFuEgYqa3";//主网
            // neb.setRequest(new nebulas.HttpRequest("https://mainnet.nebulas.io"))

            //检查扩展是否已安装
			//如果安装了扩展，var“webExtensionWallet”将被注入到web页面中1
			setTimeout(function () {
				if (typeof (webExtensionWallet) === "undefined") {
					//alert ("扩展钱包未安装，请先安装.")
					$("#noExtension").show();
				}
			}, 500);


			$("#search").click(function () {
                // layer.alert("123");
                var search_value = $("#search_value").val();
                if (search_value == '') {
                    search_value='ae703cf9555a3ab7fcf78cd03713a716be6a59ca'
                }
                var from = dappContactAddress
                var value = "0";
                var nonce = "0"
                var gas_price = "1000000"
                var gas_limit = "2000000"
                var callFunction = "get";
                var callArgs = "[\"" + search_value + "\"]";
                console.log(callArgs);
                var contract = {
                    "function": callFunction,
                    "args": callArgs
                }


				// var to = dappAddress;
				// var value = "0";
                // var nonce = "0"
                // var callFunction = "get";
				// var callArgs = [];
				// callArgs.push(search_value);
                neb.api.call(from, dappContactAddress, value, nonce, gas_price, gas_limit, contract).then(function (resp) {
                    var result = resp.result
                    if (result === 'null') {
                        layer.alert('没有查到手机相关信息');
                    } else {
                        $('#tableList').show();
                        var resultObj = JSON.parse(result);
                        // var len = resultObj.value.split('|-').length;
                        var obj = [];
                        for (var i = 0; i < 1; i++) {
                            var temp = {
                                pinpai: resultObj.pinpai,
                                model: resultObj.model,
                                price: resultObj.price,
                                phoneId: resultObj.phoneId,
                            }
                            obj.push(temp);
                        }
                        Vue.set(app, 'list', obj)
                    }

                }).catch(function (err) {
                    console.log("error :" + err.message);
                });
				// nebPay.simulateCall(to, value, callFunction, JSON.stringify(callArgs), {
				// 	listener: cbSearch
				// });
			})

			function cbSearch(resp) {

				var result = resp.result
				if (result === 'null') {
					layer.alert('没有查到手机相关信息');
				} else {
					$('#tableList').show();
					var resultObj = JSON.parse(result);
					// var len = resultObj.value.split('|-').length;
					var obj = [];
					for (var i = 0; i < 1; i++) {
						var temp = {
							pinpai: resultObj.pinpai,
							model: resultObj.model,
							price: resultObj.price,
							phoneId: resultObj.phoneId,
						}
						obj.push(temp);
					}
					Vue.set(app, 'list', obj)
				}

			}

			$("#push").click(function () {
				var phoneId = $('#phoneId').val();
				var pinpai = $('#pinpai').val();
				var model = $('#model').val();
				var price = $('#price').val();
				if (phoneId == '') {
					layer.msg('手机唯一识别码不能为空');
					return;
				} else if (pinpai == '') {
					layer.msg('手机厂商不能为空');
					return;
				} else if (model == '') {
					layer.msg('手机型号不能为空');
					return;
				} else if (price == '') {
					layer.msg('手机价格不能为空');
					return;
				}
				// var to = dappAddress;
				// var value = "0";
                // var nonce = "0"
                // var callFunction = "save"
				// var callArgs = [];
				// callArgs.push(phoneId);
				// callArgs.push(pinpai);
				// callArgs.push(model);
				// callArgs.push(price);
				// // callArgs.push(new Date().format("yyyy-MM-dd hh:mm:ss"))
				// nebPay.call(to, value, callFunction, JSON.stringify(callArgs), {
				// 	listener: cbPush
				// });

                var to = dappContactAddress;
                var value = "0";
                var callFunction = "save";
                var callArgs = "[\"" + phoneId + "\",\"" + pinpai + "\",\"" + model+ "\",\"" + price + "\"]";
                console.log(callArgs);
                serialNumber = nebPay.call(to, value, callFunction, callArgs, {    //使用nebpay的call接口去调用合约,
                    listener: function (resp) {
                        console.log("thecallback is " + resp)
                    }
                });

			});

			function cbPush(resp) {
				console.log("response of push: " + resp)
			}

			var app = new Vue({
				el: '#app',
				data: {
					list: []
				}
			});


			Date.prototype.format = function (format) {
				var args = {
					"M+": this.getMonth() + 1,
					"d+": this.getDate(),
					"h+": this.getHours(),
					"m+": this.getMinutes(),
					"s+": this.getSeconds(),
					"q+": Math.floor((this.getMonth() + 3) / 3),  //quarter
					"S": this.getMilliseconds()
				};
				if (/(y+)/.test(format))
					format = format.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
				for (var i in args) {
					var n = args[i];
					if (new RegExp("(" + i + ")").test(format))
						format = format.replace(RegExp.$1, RegExp.$1.length == 1 ? n : ("00" + n).substr(("" + n).length));
				}
				return format;
			};
		})
	</script>
</body>

</html>
